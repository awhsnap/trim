(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{331:function(e,t,i){"use strict";i.r(t),t.default={resourceName:"category",extendsController:"BaseNestedResource",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",setupList:function({list:e}){this.addControl({caption:"Create new category",className:"accented iconEdit",action:()=>this.openCreate({position:e.rootResourceModels.length+1})}),e.addFilter("TextFormElement",{name:"title",label:"Title"}),e.addFilter("NestedSelectFormElement",{name:"parentCategory",label:"Parent category",mapCaptionTo:"title",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",selectableLevel:"all",relation:{resourceName:"category"}}),e.addMassAction([{caption:"Publish",updateAttributes:{published:!0}},{caption:"Unpublish",updateAttributes:{published:!1}}]),e.addItem("LinkListItem",{caption:"Title",mapTo:"title",action:"editItem"}),e.addItem("TextListItem",{caption:"Description",mapTo:"description"}),e.addItem("BlipListItem",{caption:"Published",mapTo:"published",addIf:this.screenIsLarge}),e.addItem("ContextMenuListItem",{caption:"Actions",items:t=>{const i=t.get("id"),o=t.get("parentCategory"),a=t.get("childCategories"),n=o?o.get("childCategories").models.sort((e,t)=>{return e.getAttribute("position")-t.getAttribute("position")}):e.rootResourceModels,l=n.map((e,t)=>({id:e.get("id"),position:t+1})),r=l.find(e=>e.id===i).position,s=l.map(e=>e.position),d=Math.min.apply(Math,s),p=Math.max.apply(Math,s),c=e=>Promise.all(n.map((e,t)=>e.get("position")!==t+1?e.saveAttribute("position",t+1):null)).then(()=>{const i=t.get("position"),o=i+e,a=n.find(e=>e.get("position")===o);return Promise.all([t.saveAttribute("position",o),a.saveAttribute("position",i)])}),m=[{caption:"Edit category",url:e=>this.getEditUrl({id:i}),action:e=>this.openEdit({id:i})},{caption:"Add subcategory",url:e=>this.getCreateUrl({parentCategoryId:i,position:a?a.length+1:1}),action:e=>this.openCreate({parentCategoryId:i,position:a?a.length+1:1})}];return r>d&&m.push({caption:"Move up",action:(e,t)=>(t.close(),c(-1))}),r<p&&m.push({caption:"Move down",action:(e,t)=>(t.close(),c(1))}),m}})},setupEdit:function({edit:e,method:t,query:i}){this.addToIndexControl().addSaveControl(),e.addField("TextFormElement",{label:"Title",name:"title",attributes:{input:{class:"inputType2 size2"}},layoutReference:"mainRegion"}),e.addField("TextareaFormElement",{label:"Description",name:"description",layoutReference:"mainRegion"}),e.addField("FileAttachmentFormElement",{label:"Image",name:"image",mapThumbnailTo:"imageThumbnailUrl",mapCurrentFileUrlTo:"imageOriginalUrl",layoutReference:"mainRegion"}),e.addField("NestedSelectFormElement",{readOnly:"edit"===t,value:i.parentCategoryId,name:"parentCategory",label:"Parent category",mapCaptionTo:"title",mapParentTo:"parentCategory",mapChildrenTo:"childCategories",mapPositionTo:"position",selectableLevel:"all",relation:{type:"hasOne",resourceName:"category"},layoutReference:"sideRegion"}),e.addField("SelectFormElement",{label:"Published status",name:"published",selectOptions:[{caption:"Published",value:!0},{caption:"Not published",value:!1}],layoutReference:"sideRegion"}),e.addField("HiddenFormElement",{name:"position",addIf:"create"===t,value:i.position?parseInt(i.position,10):1})}}}}]);