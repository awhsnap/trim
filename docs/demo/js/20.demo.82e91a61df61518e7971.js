(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{248:function(e,t,n){var i=n(286);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n(4).default)("203fcd3e",i,!0,{})},285:function(e,t,n){"use strict";var i=n(248);n.n(i).a},286:function(e,t,n){(e.exports=n(3)(!1)).push([e.i,"@charset \"UTF-8\";\n.nestedSelectElement {\n  display: inline-block;\n  position: relative;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.nestedSelectElement > .controls {\n    -webkit-transition: opacity 0.2s;\n    -o-transition: opacity 0.2s;\n    transition: opacity 0.2s;\n}\n.nestedSelectElement.hasOne > .controls > .item {\n    font-size: 1.6em;\n    line-height: 1.14286;\n    display: inline-block;\n    color: #303030;\n}\n.nestedSelectElement.hasOne > .controls > .item > .removeBtn {\n      font-size: 0.71429em;\n      width: 2em;\n      height: 2em;\n      position: absolute;\n      right: -0.8em;\n      top: -0.8em;\n      z-index: 10;\n}\n.nestedSelectElement.hasOne > .controls > .item > .removeBtn:before {\n        content: 'Ã—';\n        width: 1.4em;\n        height: 1.4em;\n        line-height: 1em;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        position: absolute;\n        left: 50%;\n        top: 50%;\n        margin: -0.7em 0 0 -0.7em;\n        color: rgba(0, 0, 0, 0.3);\n        border: 1px solid rgba(0, 0, 0, 0.15);\n        border-radius: 50%;\n        background-color: #fff;\n}\n.nestedSelectElement.hasOne > .controls > .item > .removeBtn:hover:before {\n        -webkit-box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.15);\n                box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.15);\n}\n@media screen and (min-width: 61.3125em) {\n.nestedSelectElement.hasOne > .controls > .item {\n        font-size: 1.4em;\n}\n}\n.nestedSelectElement.hasMany > .controls > .item {\n    display: inline-block;\n    font-size: 1.2em;\n    line-height: 1.25;\n    position: relative;\n    padding: 0.16667em 0.5em 0.16667em 1.5em;\n    margin: 0.41667em 0.41667em 0 0;\n    vertical-align: middle;\n    border-radius: 0.25em;\n    border: 1px solid #8f8f8f;\n    cursor: auto;\n    color: #fff;\n    letter-spacing: 0.02em;\n    background-color: #9c9c9c;\n}\n.nestedSelectElement.hasMany > .controls > .item > .removeBtn {\n      font-size: 0.83333em;\n      position: absolute;\n      left: 0;\n      top: 50%;\n      z-index: 10;\n      width: 2em;\n      line-height: 2em;\n      height: 2em;\n      margin-top: -1em;\n      text-align: center;\n      color: #fff;\n      cursor: pointer;\n}\n.nestedSelectElement .openBtn {\n    font-size: 1.6em;\n    line-height: 2.28571;\n    text-align: left;\n    padding: 0 1.875em 0 0.625em;\n    display: block;\n    width: 100%;\n}\n.nestedSelectElement .openBtn:before {\n      font-size: 1em;\n      color: #e03431;\n      left: auto;\n      right: 0;\n      width: 2.2em;\n}\n@media screen and (min-width: 61.3125em) {\n.nestedSelectElement .openBtn {\n        font-size: 1.4em;\n        padding: 0 2.14286em 0 0.71429em;\n}\n}\n.nestedSelectElement.hasItems {\n    padding: 0 2.6em 0.6em 0.5em;\n}\n.nestedSelectElement.hasItems .openBtn {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n}\n.nestedSelectElement > .dropdown {\n    display: none;\n    position: absolute;\n    z-index: 20;\n    top: 100%;\n    left: -1px;\n    right: -1px;\n    margin: 0.5em 0 5em;\n    min-width: 20em;\n    background: #fff;\n    border: 1px solid #dddddd;\n    -webkit-box-shadow: 0 0.1em 0.3em rgba(0, 0, 0, 0.06);\n            box-shadow: 0 0.1em 0.3em rgba(0, 0, 0, 0.06);\n    border-radius: 0.4em;\n}\n.nestedSelectElement .itemList {\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 30em;\n    padding: 1em 0;\n}\n.nestedSelectElement .itemList ul {\n      border-left: 1px solid #dddddd;\n      display: none;\n}\n.nestedSelectElement .itemList ul.active {\n        display: block;\n        -webkit-animation: slideDownFadeIn 0.15s;\n                animation: slideDownFadeIn 0.15s;\n}\n.nestedSelectElement .itemList li {\n      position: relative;\n      padding: 0 0 0 2.5em;\n}\n.nestedSelectElement .itemList .listItem {\n      display: block;\n      width: 100%;\n      font-size: 1.4em;\n      padding: 0.35714em 0.35714em 0.35714em 0.42857em;\n      margin-left: -0.42857em;\n      line-height: 1.4;\n      cursor: auto;\n      border-radius: 0.21429em;\n      text-align: left;\n}\n.nestedSelectElement .itemList .listItem.selectableItem {\n        cursor: pointer;\n}\n.nestedSelectElement .itemList .listItem.selectableItem:hover {\n          color: #e03431;\n          background-color: #f5f5f5;\n}\n.nestedSelectElement .itemList .treeBtn {\n      position: absolute;\n      left: 0;\n      top: 0.2em;\n      width: 2.5em;\n      height: 2.5em;\n      opacity: 0.3;\n}\n.nestedSelectElement .itemList .treeBtn:before {\n        font-size: 1.2em;\n}\n.nestedSelectElement .itemList .treeBtn:hover {\n        color: #e03431;\n        opacity: 1;\n}\n.nestedSelectElement .search {\n    display: block;\n    padding: 0;\n}\n.nestedSelectElement .search:before {\n      font-size: 1.4em;\n      width: 1.78571em;\n      opacity: 0.3;\n      top: -0.35714em;\n      margin-top: 0;\n}\n.nestedSelectElement .search > input {\n      -webkit-appearance: none;\n         -moz-appearance: none;\n              appearance: none;\n      font-size: 1.6em;\n      color: #666666;\n      padding: 0.4375em;\n      width: 100%;\n      padding-left: 1.5625em;\n      border: 0;\n      border-bottom: 1px solid #dddddd;\n      background: transparent;\n}\n.nestedSelectElement .searchResults {\n    overflow-x: hidden;\n    overflow-y: auto;\n    max-height: 30em;\n    padding: 1em;\n    display: none;\n}\n.nestedSelectElement .searchResultItem, .nestedSelectElement .noSearchResults {\n    display: block;\n    width: 100%;\n    font-size: 1.4em;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n    padding: 0.35714em;\n    line-height: 1.4;\n    cursor: pointer;\n    border-radius: 0.21429em;\n    text-align: left;\n}\n.nestedSelectElement .searchResultItem.focused, .nestedSelectElement .searchResultItem.active, .nestedSelectElement .noSearchResults.focused, .nestedSelectElement .noSearchResults.active {\n      color: #e03431;\n      background-color: #f5f5f5;\n}\n.nestedSelectElement .noSearchResults {\n    opacity: 0.5;\n    cursor: auto;\n}\n.nestedSelectElement.loading > .controls {\n    opacity: 0.5;\n}\n.nestedSelectElement.loading .openBtn:before {\n    -webkit-animation: rotate 0.8s infinite;\n            animation: rotate 0.8s infinite;\n}\n.nestedSelectElement.active > .dropdown {\n    display: block;\n    -webkit-animation: slideDownFadeIn 0.15s;\n            animation: slideDownFadeIn 0.15s;\n}\n.nestedSelectElement.searchActive .itemList {\n    display: none;\n}\n.nestedSelectElement.searchActive .searchResults {\n    display: block;\n}\n",""])},320:function(e,t,n){"use strict";n.r(t);var i=n(11),o=n(2),s=n(12),l={name:"tree-node",props:{model:Object,expandedResourceIds:Array,getModelCaption:Function,onExpand:Function,onCollapse:Function,onSelect:Function,isLeaf:Function,getModelChildren:Function,isLevelSelectable:Function},computed:{caption:function(){return this.getModelCaption(this.model)},selectable:function(){return this.isLevelSelectable(this.model)},expandable:function(){return!this.isLeaf(this.model)},expanded:function(){return this.expandedResourceIds.indexOf(this.model.get("id"))>=0},children:function(){if(this.expandable&&this.expanded){var e=this.getModelChildren(this.model);return e?e.models:[]}return[]}},methods:{toggleNode:function(){this.expanded?this.onCollapse(this.model):this.onExpand(this.model)}}},r=n(1),a=Object(r.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",[n("button",{staticClass:"nBtn listItem",class:{selectableItem:e.selectable},attrs:{type:"button"},on:{click:function(t){return e.onSelect(e.model)}}},[e._v(e._s(e.caption))]),e._v(" "),e.expandable?n("button",{staticClass:"treeBtn nBtn icr iconPlus",attrs:{type:"button"},on:{click:e.toggleNode}}):e._e(),e._v(" "),e.expanded?n("ul",{staticClass:"active"},e._l(e.children,function(t){return n("tree-node",{key:t.get("id"),attrs:{model:t,expandedResourceIds:e.expandedResourceIds,getModelCaption:e.getModelCaption,onExpand:e.onExpand,onCollapse:e.onCollapse,onSelect:e.onSelect,isLeaf:e.isLeaf,isLevelSelectable:e.isLevelSelectable,getModelChildren:e.getModelChildren}})}),1):e._e()])},[],!1,null,null,null).exports,c=n(14),d=n(16),u=n.n(d),h={elementType:"nestedSelect",components:{ElementWrapper:s.a,TreeNode:a},mixins:[i.a,u.a],props:{value:{type:String,default:""},mapCaptionTo:{type:[String,Function],default:"title"},mapSearchCaptionTo:{type:[String,Function]},mapParentTo:{type:[String,Function],default:"parent"},mapChildrenTo:{type:[String,Function],default:"children"},mapIsLeafTo:{type:[String,Function]},mapLevelTo:{type:[String,Function]},selectableLevel:{type:[String,Array,Function],default:"leaf"},resourceQuery:{type:Object},select:{type:String,default:"one"},selectText:{type:String,default:function(){return Object(o.a)("formElements.nestedSelect.selectText")}},searchPlaceholder:{type:String,default:function(){return Object(o.a)("formElements.nestedSelect.searchPlaceholder")}}},data:function(){return{loading:!1,relatedModels:void 0,dropdownActive:!1,resourceCollection:void 0,searchQuery:"",searchResults:void 0,searchPosition:0,expandedResourceIds:[]}},computed:{resourceName:function(){return this.relation&&this.relation.resourceName||this.name},selectsOne:function(){return this.relation&&this.relation.type?"hasOne"===this.relation.type:"one"===this.select},rootResourceModels:function(){var e=this;return this.resourceCollection?this.resourceCollection.filter(function(t){return 0===e.getModelLevel(t)}):void 0},inputWrapperAttributes:function(){var e=this.normalizeAttributes(this.attributes.inputWrapper);return e.class=["nestedSelectElement",this.selectsOne?"hasOne":"hasMany",this.relatedModels&&"hasItems",this.dropdownActive&&"active",this.searchIsActive&&"searchActive",this.loading&&"loading",e.class||""].filter(function(e){return e}).join(" "),e},searchIsActive:function(){return this.searchQuery.length>0&&this.searchResults}},watch:{value:"syncRelatedModels",searchQuery:"runSearch"},created:function(){this.syncRelatedModels()},methods:{getModelCaption:function(e){return"function"==typeof this.mapCaptionTo?this.mapCaptionTo(e):e.get(this.mapCaptionTo)},getModelSearchCaption:function(e){if(this.mapSearchCaptionTo)return"function"==typeof this.mapSearchCaptionTo?this.mapSearchCaptionTo(e):e.get(this.mapSearchCaptionTo)},expandNode:function(e){this.expandedResourceIds.push(e.get("id"))},collapseNode:function(e){this.expandedResourceIds=this.expandedResourceIds.filter(function(t){return t!==e.get("id")})},selectModel:function(e){if(this.isLevelSelectable(e)){if(this.selectsOne)this.relatedModels=[e],this.closeDropdown();else if(this.relatedModels){this.relatedModels.filter(function(t){return t.get("id")===e.get("id")}).length>0||this.relatedModels.push(e)}else this.relatedModels=[e];this.$emit("input",this.relatedModels.map(function(e){return e.get("id")}).join(","))}},deselectModel:function(e){return this.relatedModels&&(this.relatedModels=this.relatedModels.filter(function(t){return t.get("id")!==e.get("id")}),0===this.relatedModels.length&&(this.relatedModels=void 0)),this.$emit("input",this.relatedModels?this.relatedModels.map(function(e){return e.get("id")}).join(","):""),this},toggleDropdown:function(){this.dropdownActive?this.closeDropdown():this.openDropdown()},openDropdown:function(){var e=this;this.dropdownActive=!0,this.getResourceCollection().then(function(){return e.$nextTick()}).then(function(){return e.$refs.searchInput.focus()})},closeDropdown:function(){this.dropdownActive=!1,this.searchPosition=0},isLevelSelectable:function(e){var t=this.selectableLevel;return"leaf"===t?this.isLeaf(e):"all"===t||(Array.isArray(t)?t.indexOf(this.getModelLevel(e))>=0:"function"==typeof t?t({model:e,nestedSelect:this}):void 0)},isLeaf:function(e){return this.mapIsLeafTo?"function"==typeof this.mapIsLeafTo?this.mapIsLeafTo(e,this.resourceCollection):e.get(this.mapIsLeafTo):!1===Boolean(this.getModelChildren(e))},getModelLevel:function(e){if(this.mapLevelTo)return"function"==typeof this.mapLevelTo?this.mapLevelTo(e):e.get(this.mapLevelTo);var t=e.get(this.mapParentTo);return t?1+this.getModelLevel(t):0},getModelChildren:function(e){return"function"==typeof this.mapChildrenTo?this.mapChildrenTo(e,this.resourceCollection):e.get(this.mapChildrenTo)},syncRelatedModels:function(){var e=this,t=this.value.split(",").filter(function(e){return e.length});if(0===t.length)return this.relatedModels=void 0,Promise.resolve(this.relatedModels);if(this.relatedModels&&this.areCollectionsAligned(t,this.relatedModels))return Promise.resolve(this.relatedModels);if(this.resourceModel){var n=this.resourceModel.get(this.name);if(n){var i=n.models||[n];if(this.areCollectionsAligned(t,i))return this.relatedModels=i,Promise.resolve(this.relatedModels)}}return this.loading=!0,Promise.all(t.map(function(t){return c.b.getFromApi({type:e.resourceName,id:t})})).then(function(t){return e.loading=!1,e.relatedModels=t,t})},areCollectionsAligned:function(e,t){var n=e.length===t.length,i=e.every(function(e){return 1===t.filter(function(t){return t.get("id")===e}).length});return n&&i},getResourceCollection:function(){var e=this;return this.resourceCollectionPromise||(this.loading=!0,this.resourceCollectionPromise=c.a.getFromApi({type:this.resourceName,query:this.resourceQuery}).then(function(t){return e.loading=!1,e.resourceCollection=t,t})),this.resourceCollectionPromise},setupSearchEngine:function(){var e=this;return this.searchEnginePromise||(this.searchEnginePromise=n.e(2).then(n.t.bind(null,308,7)).then(function(t){return new(0,t.default)(e.resourceCollection.filter(function(t){return e.isLevelSelectable(t)}).map(function(t){return{id:t.get("id"),caption:e.getModelCaption(t),searchCaption:e.getModelSearchCaption(t)}}),{keys:["caption"],threshold:.4})})),this.searchEnginePromise},runSearch:function(){var e=this;clearTimeout(this.searchTimeout),0!==this.searchQuery.length&&(this.searchTimeout=setTimeout(function(){e.searchPosition=0,e.getResourceCollection().then(function(){return e.setupSearchEngine()}).then(function(t){e.searchResults=t.search(e.searchQuery).map(function(e,t){return e.selected=0===t,e})})},100))},selectFocusedItem:function(){this.searchResults&&this.selectSearchResult(this.searchResults[this.searchPosition])},selectSearchResult:function(e){this.selectModel(this.resourceCollection.getModel(e.id))},focusNextResult:function(){this.focusSearchResult(this.searchPosition+1)},focusPrevResult:function(){this.focusSearchResult(this.searchPosition-1)},focusSearchResult:function(e){if(this.searchResults&&this.searchResults.length){var t=this.searchResults.length-1;e<0?e=t:e>t&&(e=0),this.searchPosition=e,this.searchResults.forEach(function(t,n){t.selected=n===e})}}}},m=(n(285),Object(r.a)(h,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("element-wrapper",e._b({directives:[{name:"on-dismiss",rawName:"v-on-dismiss",value:{callback:e.closeDropdown,watch:e.dropdownActive},expression:"{callback: closeDropdown, watch: dropdownActive}"}]},"element-wrapper",e.elementWrapperProps,!1),[n("div",{staticClass:"controls"},[e._l(e.relatedModels,function(t){return n("div",{key:t.get("id"),staticClass:"item"},[e._v("\n            "+e._s(e.getModelCaption(t))+"\n            "),e.isInteractive?n("button",{staticClass:"removeBtn iconClose icr nBtn",attrs:{type:"button"},on:{click:function(n){e.isInteractive&&e.deselectModel(t)}}}):e._e()])}),e._v(" "),n("button",{staticClass:"openBtn nBtn",class:{iconMoreHorizontal:e.isInteractive},attrs:{type:"button"},on:{click:function(t){e.isInteractive&&e.toggleDropdown()}}},[e._v(e._s(e.value?"":e.selectText))])],2),e._v(" "),e.dropdownActive&&e.isInteractive&&!e.loading?n("div",{staticClass:"dropdown"},[n("div",{staticClass:"search iconSearch"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"searchInput",staticClass:"searchInput",attrs:{type:"text",placeholder:e.searchPlaceholder},domProps:{value:e.searchQuery},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.focusNextResult()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.focusPrevResult()}],keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.selectFocusedItem(t))},input:function(t){t.target.composing||(e.searchQuery=t.target.value)}}}),e._v(" "),e.searchResults?n("div",{staticClass:"searchResults"},[e._l(e.searchResults,function(t,i){return n("span",{key:t.id,staticClass:"searchResultItem",class:{focused:t.selected},domProps:{innerHTML:e._s(t.searchCaption||t.caption)},on:{mouseover:function(t){return e.focusSearchResult(i)},click:function(n){return e.selectSearchResult(t)}}})}),e._v(" "),0===e.searchResults.length?n("p",{staticClass:"noSearchResults"},[e._v("No results")]):e._e()],2):e._e()]),e._v(" "),n("ul",{staticClass:"itemList"},e._l(e.rootResourceModels,function(t){return n("tree-node",{key:t.get("id"),attrs:{model:t,expandedResourceIds:e.expandedResourceIds,getModelCaption:e.getModelCaption,onExpand:e.expandNode,onCollapse:e.collapseNode,onSelect:e.selectModel,isLeaf:e.isLeaf,isLevelSelectable:e.isLevelSelectable,getModelChildren:e.getModelChildren}})}),1)]):e._e()])},[],!1,null,null,null));t.default=m.exports}}]);